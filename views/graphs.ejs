<!DOCTYPE html>
<html ng-app="graphs" lang="it">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Grafici - The Smart Buoy</title>

    <script src="/js/socket.io.js"></script>
    <script src="/js/moment-with-locales.min.js"></script>

    <script src="/js/Chart.bundle.js"></script>
    <script src="/js/Chart.bundle.js"></script>
    <link href="/ela/css/lib/owl.carousel.min.css" rel="stylesheet" />
    <link href="/ela/css/lib/owl.theme.default.min.css" rel="stylesheet" />
    <!-- Bootstrap Core CSS -->
    <link href="/ela/css/lib/bootstrap/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="/ela/css/helper.css" rel="stylesheet">
    <link href="/ela/css/lib/sweetalert/sweetalert.css" rel="stylesheet">
    <link href="/ela/css/lib/sweetalert/sweetalert.css" rel="stylesheet">
    <link href="/ela/css/style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:** -->
    <!--[if lt IE 9]>
	    <script src="https:**oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
	    <script src="https:**oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    	<![endif]-->
</head>

<body ng-controller="graphs" class="fix-header fix-sidebar">
    <!-- Preloader - style you can find in spinners.css -->
    <div class="preloader">
        <svg class="circular" viewBox="25 25 50 50">
            <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" /> </svg>
    </div>
    <div id="main-wrapper">
        <%- include header.ejs %>
            <div class="page-wrapper">
                <!-- Bread crumb -->
                <div class="row page-titles">
                    <div class="col-md-5 align-self-center">
                        <h3 class="text-primary">Grafici
                            <% switch (type) {
							case 'daily' : %>
                                Giornalieri
                                <% break;

							case 'weekly' : %>
                                    Settimanali
                                    <% break;

							case 'monthly' : %>
                                        Mensili
                                        <% break;

							case 'yearly' : %>
                                            Annuali
                                            <% break;

						} %>
                        </h3>
                    </div>
                    <div class="col-md-7 align-self-center">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a>Apps</a></li>
                            <li class="breadcrumb-item"><a>Grafici</a></li>
                            <li class="breadcrumb-item active">
                                <% switch (type) {
							case 'daily' : %>
                                    Giornalieri
                                    <% break;

							case 'weekly' : %>
                                        Settimanali
                                        <% break;

							case 'monthly' : %>
                                            Mensili
                                            <% break;

							case 'yearly' : %>
                                                Annuali
                                                <% break;

						} %>
                            </li>
                        </ol>
                    </div>
                </div>
                <!-- End Bread crumb -->
                <div class="container-fluid">
                    <% for (var i = 0; i < arrayDati.length; i++) {%>
                        <% if (i % 2 == 0) {%>
                            <div class="row">
                                <% } %>
                                    <div class="col-lg-6 col-md-12 col-sm-12">
                                        <div class="card">
                                            <div class="card-title">
                                                <h4>Grafico
                                                    <%- arrayDati[i] %>
                                                        <%- strPage %>
                                                </h4>
                                            </div>
                                            <div class="chart"><iframe class="chartjs-hidden-iframe" tabindex="-1" style="display: block; overflow: hidden; border: 0px; margin: 0px; top: 0px; left: 0px; bottom: 0px; right: 0px; height: 100%; width: 100%; position: absolute; pointer-events: none; z-index: -1;"></iframe>
                                                <canvas id="<%- type %>-<%- arrayDatiTipo[i]%>-chart" class="graphs" height="373" width="747" style="display: block; width: 747px; height: 373px;"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <% if (i % 2 != 0 ){%>
                            </div>
                            <% } %>
                                <% } %>

                </div>

            </div>

            <!-- All Jquery -->
            <script src="/ela/js/lib/jquery/jquery.min.js"></script>
            <!-- Bootstrap tether Core JavaScript -->
            <script src="/ela/js/lib/bootstrap/js/popper.min.js"></script>
            <script src="/ela/js/lib/bootstrap/js/bootstrap.min.js"></script>
            <!-- slimscrollbar scrollbar JavaScript -->
            <script src="/ela/js/jquery.slimscroll.js"></script>
            <!--Menu sidebar -->
            <script src="/ela/js/sidebarmenu.js"></script>
            <!--stickey kit -->
            <script src="/ela/js/lib/sticky-kit-master/dist/sticky-kit.min.js"></script>
            <!--Custom JavaScript -->
            <script src="/ela/js/custom.min.js"></script>


            <script src="/ela/js/lib/datatables/datatables.min.js"></script>
            <script src="/ela/js/lib/datatables/cdn.datatables.net/buttons/1.2.2/js/dataTables.buttons.min.js"></script>
            <script src="/ela/js/lib/datatables/cdn.datatables.net/buttons/1.2.2/js/buttons.flash.min.js"></script>
            <script src="/ela/js/lib/datatables/cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script>
            <script src="/ela/js/lib/datatables/cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/pdfmake.min.js"></script>
            <script src="/ela/js/lib/datatables/cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js"></script>
            <script src="/ela/js/lib/datatables/cdn.datatables.net/buttons/1.2.2/js/buttons.html5.min.js"></script>
            <script src="/ela/js/lib/datatables/cdn.datatables.net/buttons/1.2.2/js/buttons.print.min.js"></script>
            <script src="/ela/js/lib/datatables/datatables-init.js"></script>
            <script type="text/javascript">
                $(document).ready(function() {
                    $('#listaSegnalazioni').DataTable({
                        "order": [
                            [0, "desc"]
                        ],
                        dom: 'Bfrtip',
                        buttons: [
                            'copy', 'csv', 'excel', 'pdf', 'print'
                        ]
                    });
                });
            </script>

            <script type="text/javascript">
                var reports = <%- JSON.stringify(reports) %>;
                var arrayDatiTipo = <%- JSON.stringify(arrayDatiTipo) %>;

                console.log(reports);

                var graphs = $('.graphs');
                for (var i = 0; i < graphs.length; i++) {

                    var strGraph = new Array();
                    for (var k = 0; k < reports.length; k++) {
                        strGraph[k] = new Object();
                        if (k == reports.length - 1) {
                            strGraph[k].t = moment(reports[k].date).toDate();
                            strGraph[k].y = reports[k][arrayDatiTipo[i]];
                        } else {
                            strGraph[k].t = moment(reports[k].date).toDate();
                            strGraph[k].y = reports[k][arrayDatiTipo[i]];
                        }
                    }

                    var cur = graphs[i];
                    var minDate = moment(reports[reports.length - 1]);
                    var maxDate = moment(reports[0]);
                    var myChart = new Chart(cur, {
                        type: 'line',
                        defaultFontFamily: 'Montserrat',
                        data: {
                            "datasets": [{
                                data: strGraph,
                                fill: false,
                                backgroundColor: 'rgba(0,103,255,.15)',
                                borderColor: 'rgba(0,103,255,0.5)',
                                borderWidth: 3.5,
                                pointStyle: 'circle',
                                pointRadius: 0,
                                borderWidth: 2,
								pointColor: 'rgba(87, 167, 134, 1)',
								pointStrokeColor: 'rgba(255, 255, 255, 0)',
								pointHighlightFill: 'rgba(87, 167, 134, 0.7)',
								pointHighlightStroke: 'rgba(87, 167, 134, 1)',
                                lineTension: 0,
                                pointBorderColor: 'transparent',
                                pointBackgroundColor: 'rgba(0,103,255,0.5)',
                            }]

                        },
                        options: {
                            responsive: true,
							pointDotRadius: 1,
							pointDotStrokeWidth: 8,
							pointHitDetectionRadius: 20,
                            tooltips: {
                                mode: 'index',
                                titleFontSize: 12,
                                titleFontColor: '#000',
                                bodyFontColor: '#000',
                                backgroundColor: '#fff',
                                titleFontFamily: 'Montserrat',
                                bodyFontFamily: 'Montserrat',
                                cornerRadius: 3,
                                intersect: false,
                            },
                            legend: {
                                display: false,
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    fontFamily: 'Montserrat',
                                },


                            },
                            scales: {
                                xAxes: [{
                                    type: 'time',
                                    time: {
                                        min: minDate,
                                        max: maxDate
                                    }
                                }]
                            },
                            title: {
                                display: false,
                            }
                        }
                    });
                }
            </script>


    </div>
    <%- include modal.ejs %>
</body>

</html>